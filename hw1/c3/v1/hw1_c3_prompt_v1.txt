<system>
    You are a senior frontend/full-stack developer with 10+ years of experience.
    You are prototyping a reusable caching utility for browser environments.
    The goal is to build a production-grade-like cache layer that supports expiration, capacity management and
    persistence.
</system>

<task>
    <task_name>Caching Layer with TTL, LRU Eviction and Persistence</task_name>
    <programming_language>TypeScript</programming_language>
    <quality>Prototype (clean, well-typed, but not over-engineered)</quality>
</task>

<requirements>
    <functional>
        <requirement>
            Core cache operations
            <sub_requirement>
                <item>set(key: string, value: unknown, ttlMs?: number): void</item>
                <item>get(key: string): unknown | undefined</item>
                <item>delete(key: string): void</item>
                <item>clear(): void</item>
                <item>has(key: string): boolean</item>
                <item>size(): number // current number of non-expired entries</item>
            </sub_requirement>
        </requirement>
        <requirement>
            Time-to-Live (TTL) support
            <sub_requirement>
                <item>Entries can have per-entry TTL (in milliseconds)</item>
                <item>If no TTL provided when set, use default TTL from constructor options</item>
                <item>Expired entries are automatically considered invalid (get/has returns false/undefined)</item>
                <item>Lazy expiration: remove expired items only when accessed or when eviction happens</item>
            </sub_requirement>
        </requirement>
        <requirement>
            LRU (Least Recently Used) eviction
            <sub_requirement>
                <item>When cache reaches maxSize, evict the least recently used (get/set) entry</item>
                <item>get() and set() both count as "use" → move entry to most recently used position</item>
                <item>Expired entries should not prevent new items from being added (clean them during eviction if
                    needed)</item>
            </sub_requirement>
        </requirement>
        <requirement>
            Persistence to localStorage
            <sub_requirement>
                <item>Optionally persist cache content to localStorage (controlled by constructor option persist:
                    boolean | string)</item>
                <item>If persist is string → use it as storage key prefix or full key</item>
                <item>Restore cache content on instantiation if data exists in storage</item>
                <item>Write changes to storage after set/delete/clear (debounce if you want bonus)</item>
                <item>Handle JSON serialization safely (exclude functions, handle Dates, etc.)</item>
                <item>On load, filter out already expired entries</item>
            </sub_requirement>
        </requirement>
    </functional>

    <nonfunctional>
        <requirement>Proper TypeScript types — generic support for key and value is preferred (Cache&lt;K = string, V =
            unknown&gt;)</requirement>
        <requirement>Use class syntax (export class SmartCache&lt;K, V&gt; { ... })</requirement>
        <requirement>Modular design — you may split internal data structures / helpers into separate files if it
            improves readability</requirement>
        <requirement>Use custom data structures or algorithms for LRU (do NOT use any third-party cache library)
        </requirement>
        <requirement>Minimal CSS is NOT needed — this is a utility class, not a UI component</requirement>
        <requirement>Include simple usage example as JSDoc / comment at the top of the main file</requirement>
        <requirement>For testing / demonstration: support generating ~200 dummy cache entries in a test file or comment
        </requirement>
    </nonfunctional>
</requirements>

<output>
    <output_type>TypeScript class (main file) + test file</output_type>
    <main_file_name>SmartCache.ts</main_file_name>
    <test_file_name>SmartCache.test.js</test_file_name>
</output>